---
title: Datastore
description: Data store is a concept that allows you to store the data for the application.
permalink: datastore
icon: lucide:satellite-dish
order: 12
---

# Datastore

It plays an abstraction role in data retrieval, enabling centralised access to different sources such as caching solutions or external APIs such as Discord.

---

## Introduction

Le datastore est une brique logicielle indispensable pour interagir avec le monde hors de notre application.
Dans notre cas nous l'utilisons afin d'effectuer des requ√™tes HTTP vers l'API HTTP de Discord, de plus il nous permet de travailler et d'abstraire 3 axes primordiaux :

- Abstraction de la source de donn√©es (caching, rest‚Ä¶)
- Requ√™tes aupr√®s de l'API HTTP de Discord
- S√©rialization des donn√©es bruts vers des classes

---

## Fonctionnement

Le datastore est utilis√© √† chaque fois que vous tentez d'acc√©der √† une donn√©e non distribu√©e directement par un √©v√®nement ou que vous essayez d'effectuer une action vers l'API HTTP de Discord.
Le sch√©ma ci-dessous illustre le processus d'acc√®s aux donn√©es via le datastore.

### Caching

Lorsqu'un utilisateur fait une requ√™te de donn√©es au datastore, celui-ci commence par v√©rifier si les donn√©es sont disponibles dans le cache. Si les donn√©es sont pr√©sentes, elles sont r√©cup√©r√©es directement depuis le cache et renvoy√©es au datastore.

### Discord API

Dans le cas contraire, le datastore effectue une requ√™te vers l'API HTTP Discord pour obtenir les donn√©es n√©cessaires. Une fois les donn√©es r√©cup√©r√©es, le datastore fait appel √† la brique `Marshaller` qui a pour r√¥le de transformer, normaliser et s√©rialiser les donn√©es brutes en objets ou classes utilisables par l'application.

> [!note]
> Le `Marshaller` permet d'effectuer une scission propre de notre d√©pendance avec le monde ext√©rieur.

Les donn√©es transform√©es sont renvoy√©es √† l'utilisateur.

```mermaid
sequenceDiagram
    autonumber

    participant U as User
    participant D as Datastore
    participant C as Cache<br>(optional)
    participant DAPI as DiscordAPI

    U->>D: Request data

    alt Caching introspection
      D->>C: Get data
      C-->>D: Data
    else HTTP Request
      D->>DAPI: Fetch data
      DAPI-->>D: Data
    end

    create participant M as marshaller

    D->>M: Transform data
    M-->>D: Normalize & Serialize
    D-->>U: Data
```

## Usage

Lorsque vous utilisez une m√©thode devant effectuer une r√©cup√©ration de donn√©es,

### Event flow

Vous pouvez utiliser le service `rest` directement depuis le client Mineral ou en r√©cup√©rant le service `Datastore` depuis l'`IoC`.

:::code-group labels=[message_create.dart]

```dart
Future<void> main() async {
  final client = ClientBuilder()
    .setCache(MemoryProvider.new)
    .build();

  client.events.server.createMessage((message) async {
    final builder = MessageComponentBuilder()
      ..text('Hello World ! üöÄ');

    // [!code highlight]
    await message.reply(builder);
  });

  await client.init();
}
```

:::

### Explicit rest flow

Il peut arriver que vous soyez amen√© √† r√©cup√©rer des donn√©es en dehors d'une r√©action √† un √©v√®nement.
Vous pouvez utiliser le service `rest` directement depuis le client Mineral ou en r√©cup√©rant le service `Datastore` depuis l'`IoC`.

:::code-group labels=[main.dart, function.dart]

```dart
Future<void> main() async {
  final client = ClientBuilder()
    .setCache(MemoryProvider.new)
    .build();

  final serverId = '583050048766476353';
  final channels = await client.rest.channel.fetch(serverId); // [!code highlight]

  print(channels); // Map<Snowflake, Channel>

  await client.init();
}
```

```dart
Future<void> fn() async {
  final datastore = ioc.resolve<DataStoreContract>();

  final serverId = '583050048766476353';
  final channels = await datastore.channel.fetch(serverId);

  print(channels); // Map<Snowflake, Channel>
}
```

:::
